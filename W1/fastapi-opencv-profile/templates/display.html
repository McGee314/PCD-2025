<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Display Array RGB</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      .pixel-matrix {
        display: inline-block;
        border: 2px solid #333;
        background: white;
        padding: 5px;
        overflow: auto;
        max-width: 100%;
        max-height: 600px;
      }
      .pixel-row {
        display: flex;
        line-height: 0;
      }
      .pixel {
        width: 12px;
        height: 12px;
        cursor: pointer;
        border: 1px solid rgba(0,0,0,0.1);
      }
      .pixel:hover {
        border: 2px solid #000;
        transform: scale(1.2);
        z-index: 10;
        position: relative;
      }
      .info-badge {
        font-size: 0.9rem;
        padding: 8px 15px;
      }
      #pixelInfo {
        position: sticky;
        top: 10px;
        z-index: 100;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h2 class="text-center mb-4">Hasil Analisis Citra</h2>
      
      <!-- Image Info -->
      <div class="alert alert-info mb-4">
        <h5>üìä Informasi Gambar</h5>
        <div class="row">
          <div class="col-md-3">
            <strong>Dimensi Asli:</strong> {{ image_info.width }} x {{ image_info.height }} px
          </div>
          <div class="col-md-3">
            <strong>Channels:</strong> {{ image_info.channels }}
          </div>
          <div class="col-md-3">
            <strong>Matriks Display:</strong> {{ image_info.matrix_width }} x {{ image_info.matrix_height }} px
          </div>
          <div class="col-md-3">
            <strong>Total Pixels:</strong> {{ image_info.width * image_info.height }}
          </div>
        </div>
      </div>

      <!-- Original Image -->
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">üñºÔ∏è Gambar Asli</h4>
        </div>
        <div class="card-body text-center">
          <img
            src="{{ image_path }}"
            alt="Uploaded Image"
            class="img-fluid rounded shadow-lg"
            style="max-height: 400px;"
          />
        </div>
      </div>

      <!-- Pixel Matrix -->
      <div class="card mb-4">
        <div class="card-header bg-success text-white">
          <h4 class="mb-0">üî≤ Matriks Pixel</h4>
        </div>
        <div class="card-body">
          <div id="pixelInfo" class="alert alert-light mb-3">
            <strong>üí° Hover pada pixel untuk melihat nilai RGB</strong>
            <div id="pixelValue" class="mt-2"></div>
          </div>
          <div class="text-center">
            <div class="pixel-matrix">
              {% for row in pixel_matrix %}
              <div class="pixel-row">
                {% for pixel in row %}
                <div 
                  class="pixel" 
                  style="background-color: {{ pixel.hex }}"
                  data-r="{{ pixel.r }}"
                  data-g="{{ pixel.g }}"
                  data-b="{{ pixel.b }}"
                  title="R:{{ pixel.r }} G:{{ pixel.g }} B:{{ pixel.b }}"
                ></div>
                {% endfor %}
              </div>
              {% endfor %}
            </div>
          </div>
          <p class="text-center text-muted mt-3">
            <small>* Gambar di-resize ke {{ image_info.matrix_width }}x{{ image_info.matrix_height }} untuk tampilan matriks</small>
          </p>
        </div>
      </div>

      <!-- RGB Histogram Chart -->
      <div class="card mb-4">
        <div class="card-header bg-warning">
          <h4 class="mb-0">üìà Histogram RGB</h4>
        </div>
        <div class="card-body">
          <canvas id="histogramChart" height="80"></canvas>
        </div>
      </div>

      <!-- RGB Array -->
      <div class="card mb-4">
        <div class="card-header bg-info text-white">
          <h4 class="mb-0">üìù Array RGB (Gambar Asli)</h4>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <h5 class="text-center text-danger">Merah (R)</h5>
              <pre class="bg-white p-3 rounded shadow-sm" style="max-height: 300px; overflow: auto;">{{ rgb_array['R'] | safe }}</pre>
            </div>
            <div class="col-md-4">
              <h5 class="text-center text-success">Hijau (G)</h5>
              <pre class="bg-white p-3 rounded shadow-sm" style="max-height: 300px; overflow: auto;">{{ rgb_array['G'] | safe }}</pre>
            </div>
            <div class="col-md-4">
              <h5 class="text-center text-primary">Biru (B)</h5>
              <pre class="bg-white p-3 rounded shadow-sm" style="max-height: 300px; overflow: auto;">{{ rgb_array['B'] | safe }}</pre>
            </div>
          </div>
        </div>
      </div>

      <!-- Back Button -->
      <div class="text-center mt-4 mb-5">
        <a href="/" class="btn btn-secondary btn-lg">‚¨ÖÔ∏è Unggah Gambar Lain</a>
      </div>
    </div>

    <script>
      // Pixel hover effect
      document.querySelectorAll('.pixel').forEach(pixel => {
        pixel.addEventListener('mouseenter', function() {
          const r = this.getAttribute('data-r');
          const g = this.getAttribute('data-g');
          const b = this.getAttribute('data-b');
          const hex = this.style.backgroundColor;
          
          document.getElementById('pixelValue').innerHTML = `
            <div class="d-flex align-items-center justify-content-center gap-3">
              <div style="width: 50px; height: 50px; background-color: rgb(${r}, ${g}, ${b}); border: 2px solid #333; border-radius: 5px;"></div>
              <div>
                <span class="badge bg-danger info-badge">R: ${r}</span>
                <span class="badge bg-success info-badge">G: ${g}</span>
                <span class="badge bg-primary info-badge">B: ${b}</span>
                <span class="badge bg-dark info-badge">RGB(${r}, ${g}, ${b})</span>
              </div>
            </div>
          `;
        });
      });

      // Histogram Chart
      const histogramData = {{ histogram_data | tojson }};
      
      const ctx = document.getElementById('histogramChart').getContext('2d');
      const chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: Array.from({length: 256}, (_, i) => i),
          datasets: [
            {
              label: 'Red Channel',
              data: histogramData.r,
              borderColor: 'rgba(255, 99, 132, 1)',
              backgroundColor: 'rgba(255, 99, 132, 0.2)',
              borderWidth: 1.5,
              fill: true,
              tension: 0.1
            },
            {
              label: 'Green Channel',
              data: histogramData.g,
              borderColor: 'rgba(75, 192, 192, 1)',
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderWidth: 1.5,
              fill: true,
              tension: 0.1
            },
            {
              label: 'Blue Channel',
              data: histogramData.b,
              borderColor: 'rgba(54, 162, 235, 1)',
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderWidth: 1.5,
              fill: true,
              tension: 0.1
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: true,
              position: 'top',
            },
            title: {
              display: true,
              text: 'Distribusi Intensitas Warna RGB (0-255)'
            }
          },
          scales: {
            x: {
              title: {
                display: true,
                text: 'Intensitas (0-255)'
              },
              ticks: {
                maxTicksLimit: 20
              }
            },
            y: {
              title: {
                display: true,
                text: 'Frekuensi Pixel'
              },
              beginAtZero: true
            }
          },
          interaction: {
            mode: 'index',
            intersect: false,
          }
        }
      });
    </script>
  </body>
</html>
